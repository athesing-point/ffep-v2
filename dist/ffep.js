(()=>{var{defineProperty:_,getOwnPropertyNames:q,getOwnPropertyDescriptor:E}=Object,k=Object.prototype.hasOwnProperty;var W=new WeakMap,x=(O)=>{var N=W.get(O),D;if(N)return N;if(N=_({},"__esModule",{value:!0}),O&&typeof O==="object"||typeof O==="function")q(O).map((Z)=>!k.call(N,Z)&&_(N,Z,{get:()=>O[Z],enumerable:!(D=E(O,Z))||D.enumerable}));return W.set(O,N),N};var S=(O,N)=>{for(var D in N)_(O,D,{get:N[D],enumerable:!0,configurable:!0,set:(Z)=>N[D]=()=>Z})};var g={};S(g,{default:()=>o});var $={PDC:"17448046178191022",PDD:"17448045555816402"},J={INITIALIZATION:"FFEP_INITIALIZATION_ERROR",API:"FFEP_API_ERROR",CACHE:"FFEP_CACHE_ERROR",FORM_SUBMISSION:"FFEP_FORM_SUBMISSION_ERROR"};function j(O,N){let D;return function Z(...B){return new Promise((R)=>{let U=async()=>{clearTimeout(D);try{R(await O.apply(this,B))}catch(z){console.error("Error in debounced function execution:",z),R(null)}};clearTimeout(D);let L=200;try{let z=B[0];if(L=typeof N==="function"?N(z):N,isNaN(L)||L<0)console.warn("Invalid wait time calculated, using default 200ms"),L=200}catch(z){console.error("Error getting wait time for debounce:",z)}D=setTimeout(U,L)})}}var Q="ffep_cache_",M=50,h=1800000;class Y{constructor(){this.hits=0,this.misses=0,this.errors=0,this.cleanupCache()}getCacheKeys(){try{return Object.keys(sessionStorage).filter((O)=>O.startsWith(Q)).map((O)=>({key:O,timestamp:this.getItemTimestamp(O)})).sort((O,N)=>O.timestamp-N.timestamp).map((O)=>O.key)}catch(O){return console.warn("Error retrieving cache keys:",O),this.errors++,[]}}getItemTimestamp(O){try{let N=sessionStorage.getItem(O);if(!N)return 0;return JSON.parse(N)?.timestamp||0}catch(N){return console.warn(`Error parsing timestamp for cache key ${O}:`,N),0}}cleanupCache(){try{let O=this.getCacheKeys();if(O.length>M)O.slice(0,O.length-M).forEach((D)=>{try{sessionStorage.removeItem(D)}catch(Z){console.warn(`Failed to remove cache item ${D}:`,Z),this.errors++}})}catch(O){this.errors++}}getCachedItem(O){let N=Q+O;try{let D=sessionStorage.getItem(N);if(!D)return this.misses++,null;let Z=JSON.parse(D);if(Date.now()-(Z?.timestamp||0)>h)try{sessionStorage.removeItem(N)}catch(B){return console.warn(`Failed to remove expired cache item ${N}:`,B),this.errors++,this.misses++,null}return this.hits++,Z.data}catch(D){this.errors++;try{sessionStorage.removeItem(N)}catch(Z){console.warn(`Failed to remove potentially corrupted cache item ${N}:`,Z)}return null}}setCachedItem(O,N){let D=Q+O,Z={timestamp:Date.now(),data:N};try{sessionStorage.setItem(D,JSON.stringify(Z)),this.cleanupCache()}catch(B){if(this.errors++,B.name==="QuotaExceededError"||B.code&&(B.code===22||B.code===1014)){console.warn("SessionStorage quota likely exceeded. Attempting cleanup and retry...");try{let R=this.getCacheKeys(),U=Math.min(5,R.length);if(U>0)console.log(`Aggressive cleanup: Removing ${U} oldest items.`),R.slice(0,U).forEach((L)=>{try{sessionStorage.removeItem(L)}catch(z){console.warn(`Error removing item ${L} during aggressive cleanup:`,z)}});sessionStorage.setItem(D,JSON.stringify(Z)),this.cleanupCache()}catch(R){this.errors++}}}}getStats(){return{hits:this.hits,misses:this.misses,errors:this.errors,keys:this.getCacheKeys().length}}}async function C(O,N,D,Z={}){let{lastQuery:B="",suggestionsCount:R=0,apiCallCount:U=0,errorElement:L=null}=Z;if(!O||O.length<3)return null;try{let z=O.toLowerCase(),F=D.getCachedItem(z);if(F)return F.slice(0,5);if(B&&O.toLowerCase().startsWith(B.toLowerCase())&&R===0)return[];let v=`https://us-autocomplete-pro.api.smartystreets.com/lookup?${new URLSearchParams({search:O,key:N,source:"all"})}`,i=U+1,P=await fetch(v);if(!P.ok){let X=new Error(`Failed to fetch suggestions: ${P.status} ${P.statusText}`);throw X.name=J.API,X}let V=((await P.json()).suggestions||[]).slice(0,5);if(D.setCachedItem(z,V),L)L.style.display="none";return V}catch(z){if(!z.name)z.name=J.API;if(console.error("Error fetching suggestions:",z),L)L.textContent="Error fetching address suggestions.",L.style.display="block";return[]}}function T(O){if(O.autocompleteContainer=document.querySelector(".ffep-autocomplete"),!O.autocompleteContainer)return;O.addressInput.addEventListener("input",O.handleInput.bind(O)),O.addressInput.addEventListener("keydown",l.bind(null,O)),O.addressInput.addEventListener("focus",u.bind(null,O)),document.addEventListener("click",d.bind(null,O))}function b(O){if(!O.suggestions||!O.suggestions.length){G(O);return}if(!O.autocompleteContainer)return;let N=O.suggestions.map((D,Z)=>`
      <div class="ffep-suggestion" data-index="${Z}" role="option" aria-selected="false">
        ${D.street_line}, ${D.city}, ${D.state} ${D.zipcode}
      </div>
    `).join("");O.autocompleteContainer.innerHTML=N,O.autocompleteContainer.style.display="block",O.isAutocompleteVisible=!0,O.selectedIndex=-1,O.autocompleteContainer.querySelectorAll(".ffep-suggestion").forEach((D)=>{D.addEventListener("click",()=>{H(O);let Z=parseInt(D.dataset.index);if(!isNaN(Z))w(O,Z);else console.error("Invalid index found on suggestion element:",D)}),D.addEventListener("mouseover",()=>{H(O),D.classList.add("hover");let Z=parseInt(D.dataset.index);if(!isNaN(Z))O.selectedIndex=Z}),D.addEventListener("mouseout",()=>{D.classList.remove("hover")})})}function G(O){if(O.autocompleteContainer)O.autocompleteContainer.style.display="none",O.autocompleteContainer.innerHTML="";O.isAutocompleteVisible=!1,O.selectedIndex=-1}function H(O){if(!O.autocompleteContainer)return;O.autocompleteContainer.querySelectorAll(".ffep-suggestion.hover").forEach((N)=>{N.classList.remove("hover"),N.setAttribute("aria-selected","false")})}function m(O,N){if(!O.autocompleteContainer)return;let D=O.autocompleteContainer.querySelectorAll(".ffep-suggestion");if(!D.length){O.selectedIndex=-1;return}let Z=O.selectedIndex+N;if(Z<-1)Z=D.length-1;else if(Z>=D.length)Z=-1;O.selectedIndex=Z}function y(O){if(!O.autocompleteContainer)return;O.autocompleteContainer.querySelectorAll(".ffep-suggestion").forEach((D,Z)=>{if(D.classList.remove("hover"),D.setAttribute("aria-selected","false"),Z===O.selectedIndex)D.classList.add("hover"),D.setAttribute("aria-selected","true"),D.scrollIntoView({behavior:"smooth",block:"nearest"})})}function w(O,N){if(N>=0&&N<O.suggestions.length){let D=O.suggestions[N];if(D){let Z=`${D.street_line}, ${D.city}, ${D.state} ${D.zipcode}`;O.addressInput.value=Z,O.lastQuery=Z,G(O),O.triggerFormSubmit()}else console.error(`Suggestion at index ${N} is invalid.`),G(O)}else console.error(`Invalid index ${N} for selectSuggestion.`),G(O)}function l(O,N){if(!O.isAutocompleteVisible)return;if(!O.autocompleteContainer)return;let D=O.autocompleteContainer.querySelectorAll(".ffep-suggestion");if(!D||D.length===0)return;switch(N.key){case"ArrowUp":case"ArrowDown":N.preventDefault(),m(O,N.key==="ArrowUp"?-1:1),y(O);break;case"Enter":if(N.preventDefault(),O.selectedIndex!==-1)w(O,O.selectedIndex);else G(O),O.triggerFormSubmit();break;case"Escape":N.preventDefault(),G(O);break;default:break}}function d(O,N){if(O.addressInput&&!O.addressInput.contains(N.target)&&O.autocompleteContainer&&!O.autocompleteContainer.contains(N.target))G(O)}async function u(O,N){let D=N.target.value;if(D.length>=3&&!O.isAutocompleteVisible)try{let Z=D.toLowerCase(),B=O.cacheManager.getCachedItem(Z);if(B&&B.length>0)O.suggestions=B,b(O)}catch(Z){if(console.error("Error handling focus event:",Z),O.errorElement)O.errorElement.textContent="Error retrieving suggestions.",O.errorElement.style.display="block"}else if(D.length<3)G(O)}function K(O){if(O.submitButton)O.submitButton.addEventListener("click",(N)=>{if(N.preventDefault(),!O.isAutocompleteVisible)O.triggerFormSubmit()});else console.warn("Submit button (#ffep-submit) not found. Form submission via button click disabled.");if(O.addressInput)O.addressInput.addEventListener("keydown",(N)=>{if(O.isAutocompleteVisible)return;if(N.key==="Enter")N.preventDefault(),O.triggerFormSubmit()});else console.error("Address input not found during form handler setup.")}class A{constructor(){this.addressInput=null,this.autocompleteContainer=null,this.submitButton=null,this.errorElement=null,this.suggestions=[],this.selectedIndex=-1,this.isAutocompleteVisible=!1,this.lastQuery="",this.smartyKey=this.getSmartyKey(),this.cacheManager=new Y,this.apiCallCount=0,this.debouncedFetchSuggestions=j(this.fetchAndShowSuggestions.bind(this),(O)=>O&&O.length<=4?50:200)}getSmartyKey(){return window.location.hostname.includes(".dev")?$.PDD:$.PDC}init(){if(this.addressInput=document.querySelector('[data-ffep="address"]'),!this.addressInput){this.handleInitializationError('Input with data-ffep="address" not found');return}if(this.submitButton=document.querySelector("#ffep-submit"),this.errorElement=document.querySelector(".field-error"),this.autocompleteContainer=document.querySelector(".ffep-autocomplete"),!this.autocompleteContainer)console.warn("Autocomplete container (.ffep-autocomplete) not found. Autocomplete disabled.");if(this.autocompleteContainer)T(this);K(this)}handleInitializationError(O){let N=new Error(O);N.name=J.INITIALIZATION,console.error(`[${J.INITIALIZATION}] ${O}`)}triggerFormSubmit(){try{let O=this.addressInput.value;if(!O||O.length<3){if(console.warn("Submission blocked: Address input is too short."),this.errorElement)this.errorElement.textContent="Please enter a valid address.",this.errorElement.style.display="block";return}let N=encodeURIComponent(O).replace(/%20/g,"+"),Z=`https://home.point.${window.location.hostname.includes(".dev")?"dev":"com"}/?Enter+your+home+address=${N}&address=${N}`;setTimeout(()=>{window.location.replace(Z)},0)}catch(O){if(O.name=J.FORM_SUBMISSION,console.error(`[${J.FORM_SUBMISSION}] Error during redirect:`,O),this.errorElement)this.errorElement.textContent="An error occurred. Please try again.",this.errorElement.style.display="block";G(this)}}async handleInput(O){let N=O.target.value;if(N.length<3){G(this);return}await this.debouncedFetchSuggestions(N)}async fetchAndShowSuggestions(O){if(!this.smartyKey){console.error("Smarty API key is missing. Cannot fetch suggestions.");return}try{let N={lastQuery:this.lastQuery,suggestionsCount:this.suggestions.length,apiCallCount:this.apiCallCount,errorElement:this.errorElement},D=await C(O,this.smartyKey,this.cacheManager,N);if(this.apiCallCount++,this.lastQuery=O,D)if(this.suggestions=D,this.suggestions.length>0)b(this);else G(this);else this.suggestions=[],G(this)}catch(N){console.error("Error in fetchAndShowSuggestions orchestration:",N),this.suggestions=[],G(this)}}}document.addEventListener("DOMContentLoaded",()=>{try{window.FFEPInstance=new A,window.FFEPInstance.init()}catch(O){console.error("Critical error during FFEP initialization:",O)}});var o=A;})();

//# debugId=2879A327585DA98764756E2164756E21

//# sourceMappingURL=ffep.js.map
