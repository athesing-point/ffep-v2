(()=>{var z={PDC:"17448046178191022",PDD:"17448045555816402"},X={INITIALIZATION:"FFEP_INITIALIZATION_ERROR",API:"FFEP_API_ERROR",CACHE:"FFEP_CACHE_ERROR",FORM_SUBMISSION:"FFEP_FORM_SUBMISSION_ERROR"};function D(C,j){let G;return function H(...J){return new Promise((L)=>{let N=async()=>{clearTimeout(G),L(await C.apply(this,J))};clearTimeout(G);let Q=typeof j==="function"?j(...J):j;G=setTimeout(N,Q)})}}class ${constructor(){this.form=null,this.addressInput=null,this.autocompleteContainer=null,this.suggestions=[],this.selectedIndex=-1,this.isAutocompleteVisible=!1,this.apiCallCount=0,this.cacheHits=0,this.cacheMisses=0,this.cacheErrors=0,this.lastQuery="",this.errorElement=null,this.submitButton=null,this.CACHE_PREFIX="ffep_cache_",this.MAX_CACHE_ITEMS=50,this.cleanupCache();let C=window.location.hostname;this.smartyKey=C.includes(".dev")?z.PDD:z.PDC,this.debouncedFetchSuggestions=D(this.fetchSuggestions.bind(this),(j)=>j.length<=4?50:200)}cleanupCache(){try{let C=this.getCacheKeys().length,j=this.getCacheKeys();if(j.length>this.MAX_CACHE_ITEMS)j.slice(0,j.length-this.MAX_CACHE_ITEMS).forEach((H)=>sessionStorage.removeItem(H))}catch(C){C.name=X.CACHE,C.metadata={cacheSize:this.getCacheKeys().length,cacheErrors:this.cacheErrors},Bugsnag.notify(C),console.warn("Cache cleanup failed:",C),this.cacheErrors++}}getCacheKeys(){return Object.keys(sessionStorage).filter((C)=>C.startsWith(this.CACHE_PREFIX)).sort((C,j)=>{let G=JSON.parse(sessionStorage.getItem(C))?.timestamp||0,H=JSON.parse(sessionStorage.getItem(j))?.timestamp||0;return G-H})}getCachedItem(C){try{let j=sessionStorage.getItem(this.CACHE_PREFIX+C);if(!j)return this.cacheMisses++,null;let G=JSON.parse(j);if(Date.now()-G.timestamp>1800000)return sessionStorage.removeItem(this.CACHE_PREFIX+C),this.cacheMisses++,null;return console.log(`Cache Hit: ${C}`),this.cacheHits++,G.data}catch(j){return console.warn("Cache retrieval failed:",j),this.cacheErrors++,null}}setCachedItem(C,j){try{let G={timestamp:Date.now(),data:j};sessionStorage.setItem(this.CACHE_PREFIX+C,JSON.stringify(G)),this.cleanupCache()}catch(G){this.cacheErrors++;try{this.cleanupCache(),sessionStorage.setItem(this.CACHE_PREFIX+C,JSON.stringify(cacheItem))}catch(H){this.cacheErrors++}}}init(){if(this.addressInput=document.querySelector('[data-ffep="address"]'),!this.addressInput){let C=new Error('Input with data-ffep="address" not found');C.name=X.INITIALIZATION,Bugsnag.notify(C),console.error(C);return}this.submitButton=document.querySelector("#ffep-submit"),this.errorElement=document.querySelector(".field-error"),this.setupAutocomplete(),this.setupFormHandling()}setupAutocomplete(){if(this.autocompleteContainer=document.querySelector(".ffep-autocomplete"),!this.autocompleteContainer)return;this.addressInput.addEventListener("input",this.handleInput.bind(this)),this.addressInput.addEventListener("keydown",this.handleKeydown.bind(this)),this.addressInput.addEventListener("focus",this.handleFocus.bind(this)),document.addEventListener("click",this.handleClickOutside.bind(this)),this.autocompleteContainer.addEventListener("mouseover",this.handleMouseOver.bind(this))}setupFormHandling(){let C=async()=>{try{let j=this.addressInput.value,G=encodeURIComponent(j).replace(/%20/g,"+"),L=`https://home.point.${new URL(window.location.href).hostname.includes(".dev")?"dev":"com"}/?Enter+your+home+address=${G}&address=${G}`;window.location.replace(L)}catch(j){if(j.name=X.FORM_SUBMISSION,j.metadata={addressValue:this.addressInput.value,currentUrl:window.location.href},Bugsnag.notify(j),console.error("Error during redirect:",j),this.errorElement)this.errorElement.style.display="block"}};if(this.submitButton)this.submitButton.addEventListener("click",(j)=>{if(j.preventDefault(),!this.isAutocompleteVisible)C()});this.addressInput.addEventListener("keydown",(j)=>{if(j.key==="Enter"&&!this.isAutocompleteVisible)C()})}async handleInput(C){let j=C.target.value;if(j.length<3){this.hideSuggestions();return}try{let G=await this.debouncedFetchSuggestions(j);if(G)this.suggestions=G,this.showSuggestions()}catch(G){}}async fetchSuggestions(C){if(!C||C.length<3)return null;try{let j=C.toLowerCase(),G=this.getCachedItem(j);if(G)return G.slice(0,5);if(this.lastQuery&&C.toLowerCase().startsWith(this.lastQuery.toLowerCase())&&this.suggestions.length===0)return[];let H=`https://us-autocomplete-pro.api.smartystreets.com/lookup?${new URLSearchParams({search:C,key:this.smartyKey,source:"all"})}`;this.apiCallCount++,this.lastQuery=C;let J=await fetch(H);if(!J.ok){let Q=new Error(`Failed to fetch suggestions: ${J.status} ${J.statusText}`);throw Q.name=X.API,Q.metadata={status:J.status,url:H,apiCallCount:this.apiCallCount},Bugsnag.notify(Q),Q}let N=((await J.json()).suggestions||[]).slice(0,5);if(this.setCachedItem(j,N),this.errorElement)this.errorElement.style.display="none";return N}catch(j){if(!j.name)j.name=X.API;if(Bugsnag.notify(j),console.error("Error fetching suggestions:",j),this.errorElement)this.errorElement.style.display="block";return[]}}showSuggestions(){if(!this.suggestions.length){this.hideSuggestions();return}if(!this.autocompleteContainer)return;let C=this.suggestions.map((j,G)=>`
        <div class="ffep-suggestion" data-index="${G}" role="option" aria-selected="false">
          ${j.street_line}, ${j.city}, ${j.state} ${j.zipcode}
        </div>
      `).join("");this.autocompleteContainer.innerHTML=C,this.autocompleteContainer.style.display="block",this.isAutocompleteVisible=!0,this.autocompleteContainer.querySelectorAll(".ffep-suggestion").forEach((j)=>{j.addEventListener("click",()=>{let G=parseInt(j.dataset.index);this.selectSuggestion(G)})})}hideSuggestions(){this.autocompleteContainer.style.display="none",this.isAutocompleteVisible=!1,this.selectedIndex=-1}handleKeydown(C){if(!this.isAutocompleteVisible)return;let j=this.autocompleteContainer.querySelectorAll(".ffep-suggestion");if(!j.length)return;switch(C.key){case"ArrowUp":if(C.preventDefault(),this.selectedIndex===-1)this.selectedIndex=j.length-1;else this.navigateSuggestions(-1);this.handleArrowSelection();break;case"ArrowDown":if(C.preventDefault(),this.selectedIndex===-1)this.selectedIndex=0;else this.navigateSuggestions(1);this.handleArrowSelection();break;case"Enter":if(this.selectedIndex!==-1){C.preventDefault();let G=j[this.selectedIndex];if(G){let H=parseInt(G.dataset.index);if(!isNaN(H)&&this.suggestions[H]){let J=this.suggestions[H],L=`${J.street_line}, ${J.city}, ${J.state} ${J.zipcode}`;this.addressInput.value=L,this.hideSuggestions();let N=encodeURIComponent(L).replace(/%20/g,"+"),Z=`https://home.point.${window.location.hostname.includes(".dev")?"dev":"com"}/?Enter+your+home+address=${N}&address=${N}`;window.location.replace(Z)}}}break;default:break}}navigateSuggestions(C){let j=this.autocompleteContainer.querySelectorAll(".ffep-suggestion");if(!j.length)return;if(this.selectedIndex+=C,this.selectedIndex<0)this.selectedIndex=j.length-1;if(this.selectedIndex>=j.length)this.selectedIndex=0}handleMouseOver(C){if(C.target.classList.contains("ffep-suggestion"))this.autocompleteContainer.querySelectorAll(".ffep-suggestion").forEach((G)=>{G.classList.remove("hover")}),C.target.classList.add("hover")}handleArrowSelection(){this.autocompleteContainer.querySelectorAll(".ffep-suggestion").forEach((j,G)=>{if(j.classList.remove("hover"),j.setAttribute("aria-selected","false"),G===this.selectedIndex)j.classList.add("hover"),j.setAttribute("aria-selected","true")})}selectSuggestion(C){let j=this.autocompleteContainer.querySelectorAll(".ffep-suggestion");if(C!==void 0&&j[C]){let G=j[C],H=parseInt(G.dataset.index);if(!isNaN(H)&&this.suggestions[H]){let J=this.suggestions[H],L=`${J.street_line}, ${J.city}, ${J.state} ${J.zipcode}`;this.addressInput.value=L,this.hideSuggestions();let N=encodeURIComponent(L).replace(/%20/g,"+"),Z=`https://home.point.${window.location.hostname.includes(".dev")?"dev":"com"}/?Enter+your+home+address=${N}&address=${N}`;window.location.replace(Z)}}}handleClickOutside(C){if(!this.autocompleteContainer.contains(C.target)&&C.target!==this.addressInput)this.hideSuggestions()}async handleFocus(C){let j=C.target.value;if(j.length<3)return;if(this.isAutocompleteVisible)return;try{let G=j.toLowerCase(),H=this.getCachedItem(G);if(H&&H.length>0)console.log(`Reshowing cached results for: ${j} on focus`),this.suggestions=H,this.showSuggestions()}catch(G){console.error("Error fetching cached suggestions on focus:",G)}}}document.addEventListener("DOMContentLoaded",()=>{window.FFEP=$,new $().init()});})();

//# debugId=6B4AB5A0E68A90AB64756E2164756E21

//# sourceMappingURL=ffep.js.map
