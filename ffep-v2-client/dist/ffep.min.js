var FFEP=(()=>{var o={PDC:"17448046178191022",PDD:"17448045555816402"};function l(i,e){let t;return(...s)=>{clearTimeout(t),t=setTimeout(()=>i(...s),e)}}var n=class{constructor(){this.form=null,this.addressInput=null,this.autocompleteContainer=null,this.suggestions=[],this.selectedIndex=-1,this.isAutocompleteVisible=!1,this.apiCallCount=0;let e=window.location.hostname;this.smartyKey=e.includes(".dev")?o.PDD:o.PDC,this.debouncedFetchSuggestions=l(this.fetchSuggestions.bind(this),300)}init(){if(this.form=document.querySelector('form[data-ffep="form"]'),!this.form){console.error("FFEP form not found");return}if(this.addressInput=this.form.querySelector('[data-ffep="address"]'),!this.addressInput){console.error("Address input not found");return}this.setupAutocomplete(),this.setupFormHandling()}setupAutocomplete(){if(this.autocompleteContainer=document.querySelector(".ffep-autocomplete"),!this.autocompleteContainer){console.error("Autocomplete container with class 'ffep-autocomplete' not found");return}this.addressInput.addEventListener("input",this.handleInput.bind(this)),this.addressInput.addEventListener("keydown",this.handleKeydown.bind(this)),document.addEventListener("click",this.handleClickOutside.bind(this))}setupFormHandling(){this.form.addEventListener("submit",async e=>{e.preventDefault();let t=this.addressInput.value,s=encodeURIComponent(t).replace(/%20/g,"+"),a=new URL(window.location.href).hostname.includes(".dev")?"dev":"com",d="https://home.point.".concat(a,"/?Enter+your+home+address=").concat(s,"&address=").concat(s);window.location.replace(d)})}async handleInput(e){let t=e.target.value;if(t.length<3){this.hideSuggestions();return}try{let s=await this.debouncedFetchSuggestions(t);s&&(this.suggestions=s,this.showSuggestions())}catch(s){}}async fetchSuggestions(e){if(!e||e.length<3)return null;let t="https://us-autocomplete-pro.api.smartystreets.com/lookup?".concat(new URLSearchParams({search:e,key:this.smartyKey,source:"all"}));this.apiCallCount++,console.log("API calls made: ".concat(this.apiCallCount));let s=await fetch(t);if(!s.ok)throw new Error("Failed to fetch suggestions");return(await s.json()).suggestions||[]}showSuggestions(){if(!this.suggestions.length){this.hideSuggestions();return}if(!this.autocompleteContainer){console.error("Autocomplete container is null!");return}let e=this.suggestions.map((t,s)=>'\n        <div class="ffep-suggestion '.concat(s===this.selectedIndex?"selected":"",'"\n             style="padding: 8px 12px; cursor: pointer; hover: background-color: #f5f5f5;"\n             data-index="').concat(s,'">\n          ').concat(t.street_line,", ").concat(t.city,", ").concat(t.state," ").concat(t.zipcode,"\n        </div>\n      ")).join("");this.autocompleteContainer.innerHTML=e,this.autocompleteContainer.style.display="block",this.isAutocompleteVisible=!0,this.autocompleteContainer.querySelectorAll(".ffep-suggestion").forEach(t=>{t.addEventListener("click",()=>{let s=parseInt(t.dataset.index);this.selectSuggestion(s)}),t.addEventListener("mouseover",()=>{this.selectedIndex=parseInt(t.dataset.index),this.highlightSuggestion()})})}hideSuggestions(){this.autocompleteContainer.style.display="none",this.isAutocompleteVisible=!1,this.selectedIndex=-1}handleKeydown(e){if(this.isAutocompleteVisible)switch(e.key){case"ArrowDown":e.preventDefault(),this.selectedIndex=Math.min(this.selectedIndex+1,this.suggestions.length-1),this.highlightSuggestion();break;case"ArrowUp":e.preventDefault(),this.selectedIndex=Math.max(this.selectedIndex-1,0),this.highlightSuggestion();break;case"Enter":this.selectedIndex>=0&&(e.preventDefault(),this.selectSuggestion(this.selectedIndex));break;case"Escape":this.hideSuggestions();break}}highlightSuggestion(){let e=this.autocompleteContainer.querySelectorAll(".ffep-suggestion");e.forEach((t,s)=>{t.style.backgroundColor=s===this.selectedIndex?"#f5f5f5":""}),this.selectedIndex>=0&&e[this.selectedIndex].scrollIntoView({block:"nearest",behavior:"smooth"})}selectSuggestion(e){let t=this.suggestions[e];this.addressInput.value="".concat(t.street_line,", ").concat(t.city,", ").concat(t.state," ").concat(t.zipcode),this.hideSuggestions()}handleClickOutside(e){!this.autocompleteContainer.contains(e.target)&&e.target!==this.addressInput&&this.hideSuggestions()}};document.addEventListener("DOMContentLoaded",()=>{window.FFEP=n,new n().init()});})();
