(()=>{var Q={PDC:"17448046178191022",PDD:"17448045555816402"};function Z(j,C){let G;return function H(...N){return new Promise((J)=>{let X=async()=>{clearTimeout(G),J(await j.apply(this,N))};clearTimeout(G),G=setTimeout(X,C)})}}class L{constructor(){this.form=null,this.addressInput=null,this.autocompleteContainer=null,this.suggestions=[],this.selectedIndex=-1,this.isAutocompleteVisible=!1,this.apiCallCount=0;let j=window.location.hostname;this.smartyKey=j.includes(".dev")?Q.PDD:Q.PDC,this.debouncedFetchSuggestions=Z(this.fetchSuggestions.bind(this),300)}init(){if(this.form=document.querySelector('form[data-ffep="form"]'),!this.form){console.error("FFEP form not found");return}if(this.addressInput=this.form.querySelector('[data-ffep="address"]'),!this.addressInput){console.error("Address input not found");return}this.setupAutocomplete(),this.setupFormHandling()}setupAutocomplete(){if(this.autocompleteContainer=document.querySelector(".ffep-autocomplete"),!this.autocompleteContainer){console.error("Autocomplete container with class 'ffep-autocomplete' not found");return}this.addressInput.addEventListener("input",this.handleInput.bind(this)),this.addressInput.addEventListener("keydown",this.handleKeydown.bind(this)),document.addEventListener("click",this.handleClickOutside.bind(this))}setupFormHandling(){this.form.addEventListener("submit",async(j)=>{j.preventDefault();let C=this.addressInput.value,G=encodeURIComponent(C).replace(/%20/g,"+"),J=`https://home.point.${new URL(window.location.href).hostname.includes(".dev")?"dev":"com"}/?Enter+your+home+address=${G}&address=${G}`;window.location.replace(J)})}async handleInput(j){let C=j.target.value;if(console.log("Input value:",C),C.length<3){this.hideSuggestions();return}try{let G=await this.debouncedFetchSuggestions(C);if(console.log("Received suggestions:",G),G)this.suggestions=G,this.showSuggestions()}catch(G){console.error("Error fetching suggestions:",G)}}async fetchSuggestions(j){if(!j||j.length<3)return null;let C=`https://us-autocomplete-pro.api.smartystreets.com/lookup?${new URLSearchParams({search:j,key:this.smartyKey,source:"all"})}`;this.apiCallCount++,console.log(`API calls made: ${this.apiCallCount}`),console.log("Fetching suggestions from URL:",C);let G=await fetch(C);if(console.log("Response status:",G.status),!G.ok)throw new Error("Failed to fetch suggestions");let H=await G.json();return console.log("Raw API response:",H),H.suggestions||[]}showSuggestions(){if(console.log("Showing suggestions:",this.suggestions),!this.suggestions.length){console.log("No suggestions to show, hiding container"),this.hideSuggestions();return}if(!this.autocompleteContainer){console.error("Autocomplete container is null!");return}let j=this.suggestions.map((C,G)=>`
        <div class="ffep-suggestion ${G===this.selectedIndex?"selected":""}"
             style="padding: 8px 12px; cursor: pointer; hover: background-color: #f5f5f5;"
             data-index="${G}">
          ${C.street_line}, ${C.city}, ${C.state} ${C.zipcode}
        </div>
      `).join("");console.log("Generated HTML:",j),this.autocompleteContainer.innerHTML=j,console.log("Setting display to block"),this.autocompleteContainer.style.display="block",this.isAutocompleteVisible=!0,this.autocompleteContainer.querySelectorAll(".ffep-suggestion").forEach((C)=>{C.addEventListener("click",()=>{let G=parseInt(C.dataset.index);this.selectSuggestion(G)}),C.addEventListener("mouseover",()=>{this.selectedIndex=parseInt(C.dataset.index),this.highlightSuggestion()})})}hideSuggestions(){this.autocompleteContainer.style.display="none",this.isAutocompleteVisible=!1,this.selectedIndex=-1}handleKeydown(j){if(!this.isAutocompleteVisible)return;switch(j.key){case"ArrowDown":j.preventDefault(),this.selectedIndex=Math.min(this.selectedIndex+1,this.suggestions.length-1),this.highlightSuggestion();break;case"ArrowUp":j.preventDefault(),this.selectedIndex=Math.max(this.selectedIndex-1,0),this.highlightSuggestion();break;case"Enter":if(this.selectedIndex>=0)j.preventDefault(),this.selectSuggestion(this.selectedIndex);break;case"Escape":this.hideSuggestions();break}}highlightSuggestion(){let j=this.autocompleteContainer.querySelectorAll(".ffep-suggestion");if(j.forEach((C,G)=>{C.style.backgroundColor=G===this.selectedIndex?"#f5f5f5":""}),this.selectedIndex>=0)j[this.selectedIndex].scrollIntoView({block:"nearest",behavior:"smooth"})}selectSuggestion(j){let C=this.suggestions[j];this.addressInput.value=`${C.street_line}, ${C.city}, ${C.state} ${C.zipcode}`,this.hideSuggestions()}handleClickOutside(j){if(!this.autocompleteContainer.contains(j.target)&&j.target!==this.addressInput)this.hideSuggestions()}}document.addEventListener("DOMContentLoaded",()=>{window.FFEP=L,new L().init()});})();
